var Findango = require('../src/index.js');
var utils = require('../src/utils.js');
var test = require('tap').test;

var EXAMPLE_DESCRIPTION = `
<p>2525 Sand Creek Rd. Brentwood, CA 94513</p><p><ul><li><a href="http://www.fandango.com/alice+through+the+looking+glass_185806/movietimes?location=94513&wssaffid=11836&wssac=123">Alice Through the Looking Glass</a></li><li><a href="http://www.fandango.com/alice+through+the+looking+glass+3d_190028/movietimes?location=94513&wssaffid=11836&wssac=123">Alice Through the Looking Glass 3D</a></li><li><a href="http://www.fandango.com/alice+through+the+looking+glass+an+imax+3d+experience_187790/movietimes?location=94513&wssaffid=11836&wssac=123">Alice Through the Looking Glass An IMAX 3D Experience</a></li><li><a href="http://www.fandango.com/the+angry+birds+movie+3d_187121/movietimes?location=94513&wssaffid=11836&wssac=123">The Angry Birds Movie 3D</a></li><li><a href="http://www.fandango.com/the+angry+birds+movie+_186944/movietimes?location=94513&wssaffid=11836&wssac=123">The Angry Birds Movie </a></li><li><a href="http://www.fandango.com/animal+house+1978+presented+by+tcm_191354/movietimes?location=94513&wssaffid=11836&wssac=123">Animal House (1978) presented by TCM</a></li><li><a href="http://www.fandango.com/barbershop3a+the+next+cut_188449/movietimes?location=94513&wssaffid=11836&wssac=123">Barbershop: The Next Cut</a></li><li><a href="http://www.fandango.com/the+boss_188400/movietimes?location=94513&wssaffid=11836&wssac=123">The Boss</a></li><li><a href="http://www.fandango.com/breakfast+at+tiffanye28099s+1961+presented+by+tcm_188769/movietimes?location=94513&wssaffid=11836&wssac=123">Breakfast at Tiffany’s (1961) presented by TCM</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war_185792/movietimes?location=94513&wssaffid=11836&wssac=123">Captain America: Civil War</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war+3d_190027/movietimes?location=94513&wssaffid=11836&wssac=123">Captain America: Civil War 3D</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war+an+imax+3d+experience_187789/movietimes?location=94513&wssaffid=11836&wssac=123">Captain America: Civil War An IMAX 3D Experience</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war+the+imax+experience_191032/movietimes?location=94513&wssaffid=11836&wssac=123">Captain America: Civil War The IMAX Experience</a></li><li><a href="http://www.fandango.com/the+darkness+_190429/movietimes?location=94513&wssaffid=11836&wssac=123">The Darkness </a></li><li><a href="http://www.fandango.com/dr.+strangelove+or3a+how+i+learned+to+stop+worrying+and+love+the+bomb+1964_438/movietimes?location=94513&wssaffid=11836&wssac=123">Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb (1964)</a></li><li><a href="http://www.fandango.com/ferris+buellere28099s+day+off+1986+presented+by+tcm_188763/movietimes?location=94513&wssaffid=11836&wssac=123">Ferris Bueller’s Day Off (1986) presented by TCM</a></li><li><a href="http://www.fandango.com/from+here+to+eternity_4597/movietimes?location=94513&wssaffid=11836&wssac=123">From Here to Eternity</a></li><li><a href="http://www.fandango.com/ghostbusters+1984+original_192199/movietimes?location=94513&wssaffid=11836&wssac=123">Ghostbusters (1984 Original)</a></li><li><a href="http://www.fandango.com/green+room_188399/movietimes?location=94513&wssaffid=11836&wssac=123">Green Room</a></li><li><a href="http://www.fandango.com/the+huntsman3a+winter27s+war_188451/movietimes?location=94513&wssaffid=11836&wssac=123">The Huntsman: Winter's War</a></li><li><a href="http://www.fandango.com/the+jungle+book+3d_190026/movietimes?location=94513&wssaffid=11836&wssac=123">The Jungle Book 3D</a></li><li><a href="http://www.fandango.com/the+jungle+book_182745/movietimes?location=94513&wssaffid=11836&wssac=123">The Jungle Book</a></li><li><a href="http://www.fandango.com/keanu_189936/movietimes?location=94513&wssaffid=11836&wssac=123">Keanu</a></li><li><a href="http://www.fandango.com/money+monster_185716/movietimes?location=94513&wssaffid=11836&wssac=123">Money Monster</a></li><li><a href="http://www.fandango.com/mother27s+day_189436/movietimes?location=94513&wssaffid=11836&wssac=123">Mother's Day</a></li><li><a href="http://www.fandango.com/neighbors+23a+sorority+rising_188454/movietimes?location=94513&wssaffid=11836&wssac=123">Neighbors 2: Sorority Rising</a></li><li><a href="http://www.fandango.com/planet+of+the+apes+1968+presented+by+tcm_188765/movietimes?location=94513&wssaffid=11836&wssac=123">Planet of the Apes (1968) presented by TCM</a></li><li><a href="http://www.fandango.com/ratchet+26+clank_184085/movietimes?location=94513&wssaffid=11836&wssac=123">Ratchet & Clank</a></li><li><a href="http://www.fandango.com/the+abolitionists_191117/movietimes?location=94513&wssaffid=11836&wssac=123">The Abolitionists</a></li><li><a href="http://www.fandango.com/the+king+and+i+1956+presented+by+tcm_188766/movietimes?location=94513&wssaffid=11836&wssac=123">The King and I (1956) presented by TCM</a></li><li><a href="http://www.fandango.com/the+shining+1980+presented+by+tcm_188768/movietimes?location=94513&wssaffid=11836&wssac=123">The Shining (1980) presented by TCM</a></li><li><a href="http://www.fandango.com/warcraft_181432/movietimes?location=94513&wssaffid=11836&wssac=123">Warcraft</a></li><li><a href="http://www.fandango.com/willy+wonka+and+the+chocolate+factory+1971+presented+by+tcm_188764/movietimes?location=94513&wssaffid=11836&wssac=123">Willy Wonka and the Chocolate Factory (1971) presented by TCM</a></li><li><a href="http://www.fandango.com/xmen3a+apocalypse_175470/movietimes?location=94513&wssaffid=11836&wssac=123">X-Men: Apocalypse</a></li><li><a href="http://www.fandango.com/xmen3a+apocalypse+3d_191724/movietimes?location=94513&wssaffid=11836&wssac=123">X-Men: Apocalypse 3D</a></li></ul></p><p><a href="http://www.fandango.com/movietimes?wssaffid=11836&wssac=123">Search other theaters</a></p>
<p>1549 Gateway Blvd. Fairfield, CA 94533</p><p><ul><li><a href="http://www.fandango.com/alice+through+the+looking+glass_185806/movietimes?location=94533&wssaffid=11836&wssac=123">Alice Through the Looking Glass</a></li><li><a href="http://www.fandango.com/alice+through+the+looking+glass+3d_190028/movietimes?location=94533&wssaffid=11836&wssac=123">Alice Through the Looking Glass 3D</a></li><li><a href="http://www.fandango.com/alice+through+the+looking+glass+an+imax+3d+experience_187790/movietimes?location=94533&wssaffid=11836&wssac=123">Alice Through the Looking Glass An IMAX 3D Experience</a></li><li><a href="http://www.fandango.com/the+angry+birds+movie+3d_187121/movietimes?location=94533&wssaffid=11836&wssac=123">The Angry Birds Movie 3D</a></li><li><a href="http://www.fandango.com/the+angry+birds+movie+_186944/movietimes?location=94533&wssaffid=11836&wssac=123">The Angry Birds Movie </a></li><li><a href="http://www.fandango.com/animal+house+1978+presented+by+tcm_191354/movietimes?location=94533&wssaffid=11836&wssac=123">Animal House (1978) presented by TCM</a></li><li><a href="http://www.fandango.com/barbershop3a+the+next+cut_188449/movietimes?location=94533&wssaffid=11836&wssac=123">Barbershop: The Next Cut</a></li><li><a href="http://www.fandango.com/batman+v+superman3a+dawn+of+justice_169807/movietimes?location=94533&wssaffid=11836&wssac=123">Batman v Superman: Dawn of Justice</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war_185792/movietimes?location=94533&wssaffid=11836&wssac=123">Captain America: Civil War</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war+3d_190027/movietimes?location=94533&wssaffid=11836&wssac=123">Captain America: Civil War 3D</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war+an+imax+3d+experience_187789/movietimes?location=94533&wssaffid=11836&wssac=123">Captain America: Civil War An IMAX 3D Experience</a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war+the+imax+experience_191032/movietimes?location=94533&wssaffid=11836&wssac=123">Captain America: Civil War The IMAX Experience</a></li><li><a href="http://www.fandango.com/the+darkness+_190429/movietimes?location=94533&wssaffid=11836&wssac=123">The Darkness </a></li><li><a href="http://www.fandango.com/dci+2016+tour+premiere_191653/movietimes?location=94533&wssaffid=11836&wssac=123">DCI 2016 Tour Premiere</a></li><li><a href="http://www.fandango.com/ferris+buellere28099s+day+off+1986+presented+by+tcm_188763/movietimes?location=94533&wssaffid=11836&wssac=123">Ferris Bueller’s Day Off (1986) presented by TCM</a></li><li><a href="http://www.fandango.com/the+huntsman3a+winter27s+war_188451/movietimes?location=94533&wssaffid=11836&wssac=123">The Huntsman: Winter's War</a></li><li><a href="http://www.fandango.com/the+jungle+book_182745/movietimes?location=94533&wssaffid=11836&wssac=123">The Jungle Book</a></li><li><a href="http://www.fandango.com/keanu_189936/movietimes?location=94533&wssaffid=11836&wssac=123">Keanu</a></li><li><a href="http://www.fandango.com/money+monster_185716/movietimes?location=94533&wssaffid=11836&wssac=123">Money Monster</a></li><li><a href="http://www.fandango.com/mother27s+day_189436/movietimes?location=94533&wssaffid=11836&wssac=123">Mother's Day</a></li><li><a href="http://www.fandango.com/neighbors+23a+sorority+rising_188454/movietimes?location=94533&wssaffid=11836&wssac=123">Neighbors 2: Sorority Rising</a></li><li><a href="http://www.fandango.com/the+nice+guys_179886/movietimes?location=94533&wssaffid=11836&wssac=123">The Nice Guys</a></li><li><a href="http://www.fandango.com/one+night+for+one+drop+2016_192164/movietimes?location=94533&wssaffid=11836&wssac=123">One Night for ONE DROP 2016</a></li><li><a href="http://www.fandango.com/ratchet+26+clank_184085/movietimes?location=94533&wssaffid=11836&wssac=123">Ratchet & Clank</a></li><li><a href="http://www.fandango.com/rifftrax+live3a+mst3k+reunion_191646/movietimes?location=94533&wssaffid=11836&wssac=123">RiffTrax Live: MST3K Reunion</a></li><li><a href="http://www.fandango.com/rifftrax+live3a+time+chasers_190748/movietimes?location=94533&wssaffid=11836&wssac=123">RiffTrax Live: Time Chasers</a></li><li><a href="http://www.fandango.com/a+story+worth+living_190805/movietimes?location=94533&wssaffid=11836&wssac=123">A Story Worth Living</a></li><li><a href="http://www.fandango.com/the+abolitionists_191117/movietimes?location=94533&wssaffid=11836&wssac=123">The Abolitionists</a></li><li><a href="http://www.fandango.com/zootopia_183935/movietimes?location=94533&wssaffid=11836&wssac=123">Zootopia</a></li></ul></p><p><a href="http://www.fandango.com/movietimes?wssaffid=11836&wssac=123">Search other theaters</a></p>
<p>641 1st St. Brentwood, CA 94513</p><p><ul><li><a href="http://www.fandango.com/the+angry+birds+movie+_186944/movietimes?location=94513&wssaffid=11836&wssac=123">The Angry Birds Movie </a></li><li><a href="http://www.fandango.com/captain+america3a+civil+war_185792/movietimes?location=94513&wssaffid=11836&wssac=123">Captain America: Civil War</a></li></ul></p><p><a href="http://www.fandango.com/movietimes?wssaffid=11836&wssac=123">Search other theaters</a></p>
`

test('get theatres from zip code', function(assert) {
  Findango.find({zipCode: '94107'})
  .then(function(theatres) {
    assert.ok(theatres.length > 1, 'more than one theatre');
    assert.end();
  })
})

test('formats showtimes from HTML description and gets location', function(assert) {
  var info = utils.getInfoFromDescription(EXAMPLE_DESCRIPTION);
  assert.ok(info.films.length > 1, 'Should have some films.');
  assert.equals(info.films[0].title, 'Alice Through the Looking Glass');
  assert.equals(info.films[0].url, 'http://www.fandango.com/alice+through+the+looking+glass_185806/movietimes?location=94513&wssaffid=11836&wssac=123');
  assert.end();
})
